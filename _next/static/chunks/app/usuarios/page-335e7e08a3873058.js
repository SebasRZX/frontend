(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{786:(e,a,r)=>{"use strict";r.d(a,{A:()=>i,O:()=>t});var o=r(5155),s=r(2115);let n=(0,s.createContext)();function t(e){let{children:a}=e,[r,t]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net","/usuarios/verificar"),{credentials:"include"});if(e.ok){let a=await e.json();t(a.usuario)}else t(null)}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{l(!1)}})()},[]),(0,o.jsx)(n.Provider,{value:{usuario:r,setUsuario:t,cargando:i},children:a})}function i(){return(0,s.useContext)(n)}},5695:(e,a,r)=>{"use strict";var o=r(8999);r.o(o,"usePathname")&&r.d(a,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(a,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(a,{useSearchParams:function(){return o.useSearchParams}})},8223:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>d});var o=r(5155),s=r(2115),n=r(5695),t=r(786),i=r(5799);function l(e){let{usuarioEditado:a,onGuardado:r}=e,t=(0,n.useRouter)(),l="https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net",[d,u]=(0,s.useState)({nombre:"",primer_apellido:"",segundo_apellido:"",usuario:"",contrasena:"",rol:"voluntario",estado:"activo"});(0,s.useEffect)(()=>{a?u({nombre:a.nombre,primer_apellido:a.primer_apellido,segundo_apellido:a.segundo_apellido,usuario:a.usuario,contrasena:"",rol:a.rol,estado:a.estado}):u({nombre:"",primer_apellido:"",segundo_apellido:"",usuario:"",contrasena:"",rol:"voluntario",estado:"activo"})},[a]);let c=e=>{let{name:a,value:r}=e.target;u(e=>({...e,[a]:r}))},m=async e=>{e.preventDefault();let o=a?"".concat(l,"/usuarios/").concat(a.id):"".concat(l,"/usuarios"),s=a?"PUT":"POST";try{let e=await fetch(o,{method:s,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)}),n=await e.json();if(!e.ok)throw Error(n.error||"Error en el servidor");i.oR.success(a?"Usuario editado correctamente":"Usuario creado correctamente"),r()}catch(e){i.oR.error(e.message)}};return(0,o.jsxs)("form",{onSubmit:m,className:"bg-gris-piedra p-6 rounded-xl shadow-md max-w-2xl mx-auto space-y-4",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-vino-sacerdotal",children:a?"Editar Usuario":"Crear Usuario"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsx)("input",{name:"nombre",value:d.nombre,onChange:c,placeholder:"Nombre",className:"p-2 border rounded",required:!0}),(0,o.jsx)("input",{name:"primer_apellido",value:d.primer_apellido,onChange:c,placeholder:"Primer Apellido",className:"p-2 border rounded",required:!0}),(0,o.jsx)("input",{name:"segundo_apellido",value:d.segundo_apellido,onChange:c,placeholder:"Segundo Apellido",className:"p-2 border rounded"}),(0,o.jsx)("input",{name:"usuario",value:d.usuario,onChange:c,placeholder:"Usuario",className:"p-2 border rounded",required:!0,disabled:!!a}),(0,o.jsx)("input",{type:"password",name:"contrasena",value:d.contrasena,onChange:c,placeholder:a?"Contrase\xf1a (dejar vac\xedo para no cambiar)":"Contrase\xf1a",className:"p-2 border rounded",...!a&&{required:!0}}),(0,o.jsxs)("select",{name:"rol",value:d.rol,onChange:c,className:"p-2 border rounded",required:!0,children:[(0,o.jsx)("option",{value:"admin",children:"Admin"}),(0,o.jsx)("option",{value:"coordinador",children:"Coordinador"}),(0,o.jsx)("option",{value:"voluntario",children:"Voluntario"})]}),(0,o.jsxs)("select",{name:"estado",value:d.estado,onChange:c,className:"p-2 border rounded",required:!0,children:[(0,o.jsx)("option",{value:"activo",children:"Activo"}),(0,o.jsx)("option",{value:"inactivo",children:"Inactivo"})]})]}),(0,o.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,o.jsx)("button",{type:"submit",className:"bg-oro-liturgico border text-white px-4 py-2 rounded btn-personalizado",children:a?"Guardar Cambios":"Crear Usuario"}),(0,o.jsx)("button",{type:"button",onClick:()=>t.push("/admin"),className:"text-white border px-4 py-2 rounded btn-personalizado",children:"Volver al Panel"})]})]})}function d(){let{usuario:e,cargando:a}=(0,t.A)(),[r,i]=(0,s.useState)([]),[d,u]=(0,s.useState)(null),c=(0,n.useRouter)(),m="https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net";(0,s.useEffect)(()=>{a||e&&["admin","coordinador"].includes(e.rol)||c.push("/"),!a&&e&&["admin","coordinador"].includes(e.rol)&&h()},[e,a,c]);let h=async()=>{let e=await fetch("".concat(m,"/usuarios"),{credentials:"include"});i(await e.json())},x=async e=>{confirm("\xbfEst\xe1 seguro de eliminar este usuario?")&&(await fetch("".concat(m,"/usuarios/").concat(e),{method:"DELETE",credentials:"include"}),h())},p=()=>{u(null),h()};return a||!e?null:(0,o.jsxs)("div",{className:"min-h-screen bg-gris-piedra p-6",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold mb-6 text-vino-sacerdotal text-center",children:"Gesti\xf3n de Usuarios"}),!d&&(0,o.jsxs)("div",{className:"max-w-3xl mx-auto bg-oro-liturgico p-6 rounded-xl shadow mb-10",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold mb-4 text-vino-sacerdotal",children:"Crear nuevo usuario"}),(0,o.jsx)(l,{onGuardado:p})]}),d&&(0,o.jsxs)("div",{className:"max-w-3xl mx-auto bg-oro-liturgico p-6 rounded-xl shadow mb-10",children:[(0,o.jsx)(l,{usuarioEditado:d,onGuardado:p}),(0,o.jsx)("button",{onClick:()=>u(null),className:"mt-4 px-4 text-white py-2 border rounded btn-personalizado",children:"Cancelar edici\xf3n"})]}),(0,o.jsxs)("div",{className:"max-w-3xl mx-auto bg-oro-liturgico p-6 rounded-xl shadow",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold mb-4 text-vino-sacerdotal",children:"Usuarios existentes"}),(0,o.jsx)("ul",{className:"divide-y",children:r.map(e=>(0,o.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("p",{className:"font-semibold text-vino-sacerdotal",children:[e.nombre," (",e.usuario,")"]}),(0,o.jsxs)("p",{className:"text-sm text-gray-600",children:["Rol: ",e.rol," | Estado: ",e.estado]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{onClick:()=>u(e),className:"text-white hover:underline mr-4",children:"Editar"}),(0,o.jsx)("button",{onClick:()=>x(e.id),className:"text-vino-sacerdotal hover:underline",children:"Eliminar"})]})]},e.id))})]})]})}},8648:(e,a,r)=>{Promise.resolve().then(r.bind(r,8223))}},e=>{var a=a=>e(e.s=a);e.O(0,[799,441,684,358],()=>a(8648)),_N_E=e.O()}]);