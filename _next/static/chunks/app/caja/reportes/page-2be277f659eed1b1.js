(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{786:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,O:()=>o});var a=r(5155),s=r(2115);let n=(0,s.createContext)();function o(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net","/usuarios/verificar"),{credentials:"include"});if(e.ok){let t=await e.json();o(t.usuario)}else o(null)}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{c(!1)}})()},[]),(0,a.jsx)(n.Provider,{value:{usuario:r,setUsuario:o,cargando:l},children:t})}function l(){return(0,s.useContext)(n)}},3749:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),s=r(2115),n=r(5695),o=r(786);function l(){let[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)([]),[o,l]=(0,s.useState)(""),[c,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),x="https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net";(0,s.useEffect)(()=>{fetch("".concat(x,"/usuarios"),{credentials:"include"}).then(e=>e.json()).then(n)},[]);let h=async()=>{let e=new URLSearchParams;if(o&&e.append("fecha_inicio",o),c){let t=c+"T23:59:59";e.append("fecha_fin",t)}d&&e.append("usuario_id",d);let r=await fetch("".concat(x,"/caja/reporte?").concat(e.toString()),{credentials:"include"});t(await r.json())};return(0,a.jsxs)("div",{className:"p-6 max-w-5xl mx-auto space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-primario",children:"\uD83D\uDCCA Reporte de Cajas"}),(0,a.jsxs)("div",{className:"grid sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Desde"}),(0,a.jsx)("input",{type:"date",value:o,onChange:e=>l(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Hasta"}),(0,a.jsx)("input",{type:"date",value:c,onChange:e=>i(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Usuario"}),(0,a.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"",children:"Todos"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]})]}),(0,a.jsx)("button",{onClick:h,className:"btn-personalizado px-4 py-2 text-white rounded",children:"Buscar"}),(0,a.jsx)("div",{className:"space-y-4",children:0===e.length?(0,a.jsx)("p",{className:"text-gray-500 italic",children:"No hay resultados para mostrar."}):e.map(e=>(0,a.jsx)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow p-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-200",children:[(0,a.jsx)("strong",{children:"Usuario:"})," ",e.nombre_usuario||"Desconocido",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Estado:"})," ",e.estado,(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Apertura:"})," ",new Date(e.fecha_apertura).toLocaleString("es-CR"),(0,a.jsx)("br",{}),"cerrada"===e.estado&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("strong",{children:"Cierre:"})," ",new Date(e.fecha_cierre).toLocaleString("es-CR"),(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Monto Apertura:"})," ₡",e.monto_apertura,(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Monto Cierre:"})," ₡",e.monto_cierre,(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Observaciones:"})," ",e.observaciones||"Ninguna"]})]})},e.id))})]})}var c=r(5799);function i(){var e,t,r;let[n,o]=(0,s.useState)([]),[l,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[m,p]=(0,s.useState)(null),b="https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net";(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat(b,"/eventos"),{credentials:"include"}),t=await e.json();o(t)}catch(e){c.oR.error("Error al cargar eventos")}})()},[]);let j=async()=>{if(!l||!d||!x)return void c.oR.warning("Debe seleccionar evento y rango de fechas");try{let e=await fetch("".concat(b,"/ventas/reporte?evento_id=").concat(l,"&desde=").concat(d,"&hasta=").concat(x),{credentials:"include"});if(!e.ok){let t=await e.json();c.oR.error(t.error||"Error al generar reporte");return}let t=await e.json();p(t)}catch(e){c.oR.error("Error al conectar con el servidor")}};return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto bg-white p-6 rounded-xl shadow mt-6 border border-gray-200",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-vino-sacerdotal",children:"Reporte de Ventas por Evento"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Evento"}),(0,a.jsxs)("select",{value:l,onChange:e=>i(e.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded-lg",children:[(0,a.jsx)("option",{value:"",children:"Seleccione un evento"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),(0,a.jsx)("input",{type:"date",value:d,onChange:e=>u(e.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),(0,a.jsx)("input",{type:"date",value:x,onChange:e=>h(e.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded-lg"})]})]}),(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsx)("button",{onClick:j,className:"bg-vino-sacerdotal text-white px-6 py-2 rounded-lg hover:bg-vino-claro transition",children:"Generar Reporte"})}),m&&(0,a.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg border border-gray-300",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Resultados del reporte:"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Total de ventas:"})," ",m.total_ventas]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Monto total:"})," ₡",(null==(e=m.monto_total)?void 0:e.toLocaleString())||0]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Ventas en efectivo:"})," ₡",(null==(t=m.total_efectivo)?void 0:t.toLocaleString())||0]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Ventas por SINPE:"})," ₡",(null==(r=m.total_sinpe)?void 0:r.toLocaleString())||0]})]})]})}function d(){let{usuario:e,cargando:t}=(0,o.A)(),r=(0,n.useRouter)();return((0,s.useEffect)(()=>{t||e&&["admin","coordinador"].includes(e.rol)||r.push("/")},[e,t,r]),t||!e)?null:(0,a.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center bg-gris-piedra p-6 space-y-4",children:[(0,a.jsx)("div",{className:"self-start",children:(0,a.jsx)("button",{onClick:()=>r.push("/caja"),className:"text-white px-4 py-2 rounded btn-personalizado transition",children:"← Volver a cajas y reportes"})}),(0,a.jsx)(l,{}),(0,a.jsx)(i,{})]})}},4456:(e,t,r)=>{Promise.resolve().then(r.bind(r,3749))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[799,441,684,358],()=>t(4456)),_N_E=e.O()}]);