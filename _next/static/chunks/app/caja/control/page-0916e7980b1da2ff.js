(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{786:(e,a,r)=>{"use strict";r.d(a,{A:()=>c,O:()=>o});var t=r(5155),s=r(2115);let n=(0,s.createContext)();function o(e){let{children:a}=e,[r,o]=(0,s.useState)(null),[c,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net","/usuarios/verificar"),{credentials:"include"});if(e.ok){let a=await e.json();o(a.usuario)}else o(null)}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{l(!1)}})()},[]),(0,t.jsx)(n.Provider,{value:{usuario:r,setUsuario:o,cargando:c},children:a})}function c(){return(0,s.useContext)(n)}},3577:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>i});var t=r(5155),s=r(2115),n=r(5695),o=r(786),c=r(5799);function l(){let[e,a]=(0,s.useState)(null),[r,n]=(0,s.useState)(""),[o,l]=(0,s.useState)(""),[i,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(!1),[b,m]=(0,s.useState)(null),x="https://backendsebas-ehe6b0e6eebbhjhe.mexicocentral-01.azurewebsites.net";(0,s.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=await fetch("".concat(x,"/caja/actual"),{credentials:"include"}),r=await e.json();if(a(r),r&&"abierta"===r.estado){let e=await fetch("".concat(x,"/caja/resumen"),{credentials:"include"}),a=await e.json();m(a.resumen)}else m(null)}catch(e){c.oR.error("Error al obtener datos de caja")}},f=async()=>{if(!r||0>Number(r))return void c.oR.error("Debe ingresar un monto v\xe1lido para apertura");h(!0);try{let e=await fetch("".concat(x,"/caja/abrir"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({monto_apertura:Number(r)})}),t=await e.json();if(!e.ok)throw Error(t.error||"Error al abrir caja");c.oR.success("Caja abierta correctamente"),a({...t,monto_apertura:r,estado:"abierta"}),n(""),j()}catch(e){c.oR.error(e.message)}finally{h(!1)}},p=async()=>{if(!o||0>Number(o))return void c.oR.error("Debe ingresar el monto contado final");h(!0);try{let e=await fetch("".concat(x,"/caja/cerrar"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({monto_cierre:Number(o),observaciones:i})}),a=await e.json();if(!e.ok)throw Error(a.error||"Error al cerrar caja");c.oR.success("Caja cerrada correctamente"),l(""),d(""),j()}catch(e){c.oR.error(e.message)}finally{h(!1)}};return(0,t.jsxs)("div",{className:"max-w-xl mx-auto mt-6 p-6 bg-white shadow rounded space-y-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-center text-black",children:"Control de Caja"}),e&&"abierta"===e.estado?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"text-green-700 font-semibold text-center",children:["Caja abierta desde: ",new Date(e.fecha_apertura).toLocaleString()]}),(0,t.jsxs)("p",{className:"text-center",children:["Monto de apertura: ₡",Number(e.monto_apertura).toLocaleString()]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold block mb-1",children:"Monto contado final:"}),(0,t.jsx)("input",{type:"number",value:o,onChange:e=>l(e.target.value),className:"border p-2 rounded w-full",placeholder:"₡"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold block mb-1",children:"Observaciones (opcional):"}),(0,t.jsx)("textarea",{value:i,onChange:e=>d(e.target.value),className:"border p-2 rounded w-full",rows:3,placeholder:"Comentarios al cerrar caja..."})]}),b&&(0,t.jsxs)("div",{className:"bg-gray-100 border p-4 rounded text-sm mt-4",children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"Resumen de Ventas:"})}),(0,t.jsxs)("ul",{className:"pl-4 list-disc",children:[(0,t.jsxs)("li",{children:["Efectivo: ₡",b.efectivo.toLocaleString()]}),(0,t.jsxs)("li",{children:["SINPE: ₡",b.sinpe.toLocaleString()]}),(0,t.jsxs)("li",{children:["Total: ₡",b.total.toLocaleString()]}),o&&(0,t.jsxs)("li",{children:["Diferencia (efectivo vs contado):"," ",(0,t.jsxs)("span",{className:Number(o)-b.efectivo==0?"text-green-700":"text-red-600",children:["₡",(Number(o)-b.efectivo).toLocaleString()]})]})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("button",{onClick:p,className:"bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 disabled:opacity-50",disabled:u,children:"Cerrar Caja"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-yellow-600 text-center",children:"No hay caja abierta actualmente."}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold block mb-1",children:"Monto de apertura:"}),(0,t.jsx)("input",{type:"number",value:r,onChange:e=>n(e.target.value),className:"border p-2 rounded w-full",placeholder:"₡"})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("button",{onClick:f,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50",disabled:u,children:"Abrir Caja"})})]})]})}function i(){let{usuario:e,cargando:a}=(0,o.A)(),r=(0,n.useRouter)();return((0,s.useEffect)(()=>{a||e&&["admin","coordinador"].includes(e.rol)||r.push("/")},[e,a,r]),a||!e)?null:(0,t.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center bg-gris-piedra p-6 space-y-4",children:[(0,t.jsx)("div",{className:"self-start",children:(0,t.jsx)("button",{onClick:()=>r.push("/caja"),className:"text-white px-4 py-2 rounded btn-personalizado transition",children:"← Volver a cajas y reportes"})}),(0,t.jsx)(l,{})]})}},5695:(e,a,r)=>{"use strict";var t=r(8999);r.o(t,"usePathname")&&r.d(a,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(a,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(a,{useSearchParams:function(){return t.useSearchParams}})},9693:(e,a,r)=>{Promise.resolve().then(r.bind(r,3577))}},e=>{var a=a=>e(e.s=a);e.O(0,[799,441,684,358],()=>a(9693)),_N_E=e.O()}]);